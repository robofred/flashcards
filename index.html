import React, { useState, useEffect } from 'react';

const MultiplicationFlashCards = () => {
  const [availableNumbers, setAvailableNumbers] = useState([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]);
  const [currentProblem, setCurrentProblem] = useState({ num1: 0, num2: 0 });
  const [options, setOptions] = useState([]);
  const [streak, setStreak] = useState(0);
  const [showSettings, setShowSettings] = useState(false);
  
  // Generate a new problem
  const generateProblem = () => {
    if (availableNumbers.length === 0) return;
    
    const num1 = availableNumbers[Math.floor(Math.random() * availableNumbers.length)];
    const num2 = availableNumbers[Math.floor(Math.random() * availableNumbers.length)];
    
    setCurrentProblem({ num1, num2 });
    
    // Generate 4 options including the correct answer
    const correctAnswer = num1 * num2;
    const newOptions = [correctAnswer];
    
    // Generate 3 unique wrong answers
    while (newOptions.length < 4) {
      const wrongNum1 = Math.floor(Math.random() * 10);
      const wrongNum2 = Math.floor(Math.random() * 10);
      const wrongAnswer = wrongNum1 * wrongNum2;
      
      if (!newOptions.includes(wrongAnswer) && wrongAnswer !== correctAnswer) {
        newOptions.push(wrongAnswer);
      }
    }
    
    // Shuffle the options
    setOptions(newOptions.sort(() => Math.random() - 0.5));
  };
  
  // Initialize the game
  useEffect(() => {
    generateProblem();
  }, [availableNumbers]);
  
  // Handle answer selection
  const handleAnswer = (selectedAnswer) => {
    const correctAnswer = currentProblem.num1 * currentProblem.num2;
    
    if (selectedAnswer === correctAnswer) {
      setStreak(streak + 1);
      generateProblem();
    } else {
      setStreak(0);
    }
  };
  
  // Handle shuffle button
  const handleShuffle = () => {
    setStreak(0);
    generateProblem();
  };
  
  // Handle number toggle in settings
  const toggleNumber = (num) => {
    if (availableNumbers.includes(num)) {
      setAvailableNumbers(availableNumbers.filter(n => n !== num));
    } else {
      setAvailableNumbers([...availableNumbers, num].sort((a, b) => a - b));
    }
  };
  
  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-blue-50 p-4">
      <div className="w-full max-w-md bg-white rounded-lg shadow-lg p-6">
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-2xl font-bold text-blue-600">Multiplication Flash Cards</h1>
          <div className="text-lg font-semibold bg-green-100 px-3 py-1 rounded-full">
            Streak: {streak}
          </div>
        </div>
        
        {/* Flash Card */}
        <div className="bg-blue-100 rounded-lg p-8 mb-6 text-center">
          <div className="text-4xl font-bold text-blue-800">
            {currentProblem.num1} Ã— {currentProblem.num2} = ?
          </div>
        </div>
        
        {/* Answer Options */}
        <div className="grid grid-cols-2 gap-4 mb-6">
          {options.map((option, index) => (
            <button
              key={index}
              onClick={() => handleAnswer(option)}
              className="bg-blue-500 hover:bg-blue-600 text-white text-xl font-semibold py-3 rounded-lg transition-colors"
            >
              {option}
            </button>
          ))}
        </div>
        
        {/* Menu */}
        <div className="flex flex-col space-y-4">
          <button
            onClick={handleShuffle}
            className="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 rounded-lg transition-colors"
          >
            Shuffle
          </button>
          
          <button
            onClick={() => setShowSettings(!showSettings)}
            className="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 rounded-lg transition-colors"
          >
            {showSettings ? 'Hide Settings' : 'Settings'}
          </button>
          
          {/* Settings Panel */}
          {showSettings && (
            <div className="bg-gray-100 rounded-lg p-4 mt-4">
              <h3 className="font-semibold mb-2">Choose Numbers:</h3>
              <div className="flex flex-wrap gap-2">
                {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (
                  <label key={num} className="flex items-center space-x-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={availableNumbers.includes(num)}
                      onChange={() => toggleNumber(num)}
                      className="form-checkbox h-5 w-5 text-blue-600"
                    />
                    <span>{num}</span>
                  </label>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default MultiplicationFlashCards;
